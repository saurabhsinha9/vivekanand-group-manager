version: "1"

projects:
  - name: Vivekanand-gayaji-prod
    environments:
      - name: Production

        services:
          # --- Frontend (Static Site) ---
          - type: web
            name: vgm-fronend
            runtime: static
            repo: https://github.com/saurabhsinha9/vivekanand-group-manager
            envVars:
              - key: VITE_API_URL
                sync: false           # (you can auto-wire this to the backend URL; see the optional variant below)
            buildCommand: npm install && npm run build
            staticPublishPath: dist
            routes:
              - type: rewrite
                source: /*
                destination: /index.html
            autoDeployTrigger: commit
            rootDir: frontend/

          # --- Backend (Docker-based Web Service) ---
          - type: web
            name: vivekanand-manager-backend
            runtime: docker
            repo: https://github.com/saurabhsinha9/vivekanand-group-manager
            plan: free
            envVars:
              - key: RCLONE_CONFIG          # all of these are placeholders; keep them in Dashboard or switch to auto-wiring DB_* below
                sync: false
              - key: STORAGE_PVR
                sync: false
              - key: JPA_DDL_AUTO
                sync: false
              - key: WA_PROVIDER
                sync: false
              - key: WA_META_PHONE_ID
                sync: false
              - key: WA_META_ACCESS_TOKEN
                sync: false
              - key: UPLOAD_MAX_MB
                sync: false
              - key: UPLOAD_DIR
                sync: false
              - key: TWILIO_WHATSAPP_FROM
                sync: false
              - key: TWILIO_TOKEN
                sync: false
              - key: TWILIO_SID
                sync: false
              - key: SWAGGER_UI_PATH
                sync: false
              - key: SPRING_PROFILES_ACTIVE
                sync: false
              - key: SPRING_APP_NAME
                sync: false
              - key: SPRINGDOC_API_ENABLED
                sync: false
              - key: PORT
                sync: false
              - key: MULTIPART_MAX_REQUEST_SIZE
                sync: false
              - key: MULTIPART_MAX_FILE_SIZE
                sync: false
              - key: MAIL_USERNAME
                sync: false
              - key: MAIL_SMTP_STARTTLS_ENABLE
                sync: false
              - key: MAIL_SMTP_AUTH
                sync: false
              - key: MAIL_PORT
                sync: false
              - key: MAIL_PASSWORD
                sync: false
              - key: MAIL_HOST
                sync: false
              - key: JWT_SECRET
                sync: false
              - key: JWT_ISSUER
                sync: false
              - key: JWT_EXP_MINUTES
                sync: false
              - key: JPA_SHOW_SQL
                sync: false
              - key: HIBERNATE_FORMAT_SQL
                sync: false
              - key: EMAIL_PROVIDER
                sync: false
              - key: EMAIL_API_URL
                sync: false
              - key: EMAIL_API_KEY
                sync: false
              - key: DB_USER
                sync: false
              - key: DB_URL
                sync: false
              - key: DB_PASS
                sync: false
              - key: CORS_ALLOWED_ORIGINS
                sync: false
              - key: CLOUDINARY_FOLDER
                sync: false
              - key: CLOUDINARY_CLOUD_NAME
                sync: false
              - key: CLOUDINARY_API_SECRET
                sync: false
              - key: CLOUDINARY_API_KEY
                sync: false
            region: singapore
            healthCheckPath: /actuator/health
            dockerContext: .
            dockerfilePath: Dockerfile
            autoDeployTrigger: commit
            rootDir: backend

        databases:
          # --- Postgres Database ---
          - name: vivekanand-manager-db
            databaseName: vivekanand_manager_db_m9hp
            user: vivekanand_manager_db_user
            plan: free
            region: singapore
            ipAllowList:
              - source: 0.0.0.0/0
                description: everywhere
            postgresMajorVersion: "18"
